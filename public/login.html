<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login - Quem Sou Eu</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <h1>Quem Sou Eu</h1>
  <p>Informe seu nome e escolha seu papel:</p>

  <input type="text" id="nome" placeholder="Seu nome">
  <div style="margin-top: 20px;">
    <div>
      <button onclick="escolher('chooser')">Sou quem escolhe</button>
      <p id="chooser-name" class="player-name"></p>
    </div>
    <div>
      <button onclick="escolher('asker')">Sou quem pergunta</button>
      <p id="asker-name" class="player-name"></p>
    </div>
  </div>

  <script>
    const nomeInput = document.getElementById('nome');
    let socket;

    function escolher(role) {
      const nome = nomeInput.value.trim();
      if (!nome) {
        Swal.fire('Digite seu nome!', '', 'warning');
        return;
      }

      socket = new WebSocket(`ws://${location.host}`);
      socket.onopen = () => {
        socket.send(JSON.stringify({ type: 'role', role, username: nome }));
      };

      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === 'error') {
          Swal.fire('Erro', data.message, 'error');
          socket.close();
        }

        if (data.type === 'game-started' || data.type === 'ready') {
          sessionStorage.setItem('role', role);
          sessionStorage.setItem('username', nome);
          window.location.href = 'jogo.html';
        }

        if (data.type === 'player-update') {
          const el = document.getElementById(`${data.role}-name`);
          el.textContent = data.username ? `ðŸ‘¤ ${data.username}` : 'Aguardando jogador...';
        }
      };

      socket.onerror = () => {
        Swal.fire('Erro', 'Erro ao conectar com o servidor.', 'error');
      };
    }

    const tempSocket = new WebSocket(`ws://${location.host}`);
    tempSocket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'player-update') {
        const el = document.getElementById(`${data.role}-name`);
        el.textContent = data.username ? `ðŸ‘¤ ${data.username}` : 'Aguardando jogador...';
      }
    };
  </script>
</body>
</html>
